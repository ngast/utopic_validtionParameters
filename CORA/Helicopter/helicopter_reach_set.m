
function helicopter_reach_set()

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Reachability analysis for systems with uncertain parameters using CORA
%
% Modified from the example example_nonlinear_reach_01_tank.m provided by CORA
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

 CORA_path='../../CORA_2016/';
 addpath(genpath(CORA_path));

 x0_= [ 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 10.0 ]';
 T = 1;
 theta_min=[ 0.1 1.0 1.5 ];
 theta_max=[ 0.7 1.5 2.0 ];
 alpha=[1.0 0];

 tic
 dim=size(x0_,1);

%set options --------------------------------------------------------------
options.tStart=0; %start time
options.tFinal=T; %final time
options.x0=x0_;
options.R0=zonotope([options.x0,0.0*eye(dim)]); %initial state for reachability analysis

options.timeStep=0.01; %time step size for reachable set computation
options.taylorTerms=20; %number of taylor terms for reachable sets

options.zonotopeOrder=80; %zonotope order
options.intermediateOrder=30;
options.reductionTechnique='girard';
options.errorOrder=4;
options.polytopeOrder=5; %polytope order
options.reductionInterval=1e3;
options.maxError = 1e1*ones(dim,1);

options.plotType='frame';
options.projectedDimensions=[1 2];

options.originContained = 0;
options.advancedLinErrorComp = 1;
options.tensorOrder = 3;

options.path = [coraroot '/contDynamics/stateSpaceModels'];
%--------------------------------------------------------------------------

v1=zeros(size(theta_min,2),1);
v2=zeros(size(theta_min,2),1);
for i=1:size(theta_min,2)
    v1(i)=0.5*(theta_max(i)+theta_min(i));
    v2(i)=0.5*(theta_max(i)-theta_min(i));
end

options.uTrans = v1; % center of uncertain inputs. 
options.U = zonotope([zeros(size(theta_min,2),1),diag(v2)]); % input for reachability analysis

% specify continuous dynamics-----------------------------------------------

tank = nonlinearSys(dim,size(theta_min,2),@ode,options); %initialize tank system
%--------------------------------------------------------------------------


%compute reachable set using zonotopes
Rcont = reach(tank, options);
tComp = toc;
disp(['computation time of reachable set: ',num2str(tComp)]);

% compute the maximum and the minimum
 Z = Rcont{length(Rcont)}{1};
 Z = project(Z,[1 2]);
 p = polygon(Z);
 res=alpha(1)*p(1,:);

 disp(['The output interval is [',num2str(min(res)),', ',num2str(max(res)),']']);

 rmpath(genpath('../../CORA_2016/'));

end


function dy =  ode(t,y,v)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Modification of the ODE system replicatedBindingSite2Asymm
% Used by ODE solvers in CORA 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

	a = v(1);
	b = v(2);
	c = v(3); 

	dy(1,1) = 0.99857378006*y(23)+0.053384274244*y(24);
	dy(2,1) = (-0.01975778857)*y(1)+0.009012833714*y(12)+0.311015942657*y(22)+2.81018120479*y(23)+(-0.001602140073)*y(24)+0*y(25)+0*y(26)+0*y(27)+0.008134087133*y(28)+(-0.003710494952)*y(2)+0.86350701147*y(3)+(-1.236460821044)*y(4)+0.060184240645*y(5)+0*y(6)+0*y(7)+0*y(8);
	dy(3,1) = (-0.030385323449)*y(1)+0.003110159427*y(12)+0.312812882924*y(22)+0.287354391281*y(23)+(-0.00233173063)*y(24)+0*y(25)+0*y(26)+0*y(27)+(-8.414922645141)*y(28)+(-36.922139523656)*y(2)+(-18.505141519315)*y(3)+(-3.793715804769)*y(4)+(-2.765572372983)*y(5)+0.035944961732*y(6)+(-0.03891010472)*y(7)+0.025846348888*y(8)+0.527826299191*y(9)+1.697201876759*y(10)+17.980094722474*y(11)+4.615721721183*y(13)+0.618925691035*y(14)+0.71776394151*y(15)+0.036154725527*y(16)+0.021151770407*y(17)+0.200211885807*y(18)+(-0.236208723376)*y(19)+(-10.127341872304)*y(20)+0.037053334254*y(21);
	dy(4,1) = 0.002667394037*y(1)+0.004496152836*y(12)+0.045956750452*y(22)+1.764514260408*y(23)+1.46052012E-4*y(24)+0*y(25)+0*y(26)+0*y(27)+(-17.119523267503)*y(28)+0.536693033369*y(2)+0.353775293385*y(3)+(-8.335731095093)*y(4)+0.078527228401*y(5)+0.005987264162*y(6)+0.006725273267*y(7)+(-0.005979187005)*y(8)+(-0.182029763642)*y(9)+3.233906041666*y(10)+(-0.268381596955)*y(11)+(-0.514971094398)*y(13)+(-0.005888452287)*y(14)+(-0.00311046421)*y(15)+0.081894084826*y(16)+0.066024394813*y(17)+(-0.104516302587)*y(18)+1.63128979696*y(19)+0.066233671911*y(20)+(-0.002829938571)*y(21);
	dy(5,1) = 0.024056576806*y(1)+(-0.001361685819)*y(12)+(-0.230715295944)*y(22)+0.185551143531*y(23)+0.001832537128*y(24)+0*y(25)+0*y(26)+(-0)*y(27)+(-1.696796379292)*y(28)+(-5.819307733117)*y(2)+(-2.712299197847)*y(3)+(-0.61581752704)*y(4)+(-4.029675752634)*y(5)+0.002306818331*y(6)+(-0.004623901048)*y(7)+0.071938991843*y(8)+2.282021405408*y(9)+0.349879770769*y(10)+2.900759066988*y(11)+4.516150272075*y(13)+0.111029828612*y(14)+0.13730505946*y(15)+0.00365562004*y(16)+0.001262406662*y(17)+1.082630189953*y(18)+(-0.024777388732)*y(19)+(-1.766450614425)*y(20)+(-0.930338103031)*y(21);
	dy(6,1) = (-1.753103616578)*y(1)+0.52186960989*y(12)+23.319318958026*y(22)+145.082271971311*y(23)+(-0.138741289403)*y(24)+(-0)*y(25)+(-0)*y(26)+8.60128319E-4*y(27)+(-11.594360544437)*y(28)+(-0.70542490241)*y(2)+(-10.592707880324)*y(3)+(-54.888617486514)*y(4)+(-0.619258600252)*y(5)+(-0.018180886764)*y(6)+(-0.016310350542)*y(7)+0.17226746335*y(8)+3.857750758541*y(9)+(-3.73362923875)*y(10)+0.251977753557*y(11)+1.659474556422*y(13)+0.007076928248*y(14)+0.00759488332*y(15)+(-0.096433822422)*y(16)+(-0.077989008913)*y(17)+1.068213380174*y(18)+(-1.854605830991)*y(19)+(-0.041177323469)*y(20)+0.038137029879*y(21);
	dy(7,1) = 1.708539622488*y(1)+0.111898315003*y(12)+(-13.174473231922)*y(22)+91.46275555623*y(23)+0.127584976026*y(24)+0*y(25)+0*y(26)+(-7.23245056E-4)*y(27)+(-1.878010842263)*y(28)+23.870898681235*y(2)+1.639719754761*y(3)+(-40.888303474223)*y(4)+2.851614162302*y(5)+0.00134943057*y(6)+(-0.024984412428)*y(7)+0.102862439056*y(8)+1.794950045519*y(9)+0.252919074168*y(10)+3.893644396914*y(11)+(-2.155538119928)*y(13)+0.123550997381*y(14)+0.137525326941*y(15)+0.007512594224*y(16)+0.004476043338*y(17)+(-0.081084731931)*y(18)+(-0.05006218142)*y(19)+(-2.033833968448)*y(20)+1.145542115841*y(21);
	dy(8,1) = (-0.069753861204)*y(1)+0.041269247265*y(12)+1.243498527057*y(22)+13.467483657041*y(23)+(-0.005772466581)*y(24)+0*y(25)+0*y(26)+0*y(27)+(-5.161896992464)*y(28)+(-0.784811430978)*y(2)+(-1.913888711445)*y(3)+(-8.087612492321)*y(4)+11.48870135415*y(5)+0.19441123747*y(6)+0.167838434014*y(7)+(-3.255004272242)*y(8)+(-71.490067651024)*y(9)+0.531333931032*y(10)+1.089774627294*y(11)+(-20.947639012098)*y(13)+(-0.006423930487)*y(14)+(-0.078948253623)*y(15)+0.050383537787*y(16)+0.045369546582*y(17)+(-18.580601832107)*y(18)+(-0.295436370828)*y(19)+(-0.680521274763)*y(20)+(-0.683600561672)*y(21);
	dy(9,1) = (-0.013549327978)*y(25)+(-0.012135188033)*y(26)+0.226991094595*y(27)+(-0.012)*y(9);
	dy(10,1) = (-11.385989897412)*y(1)+(-0.005)*y(10);
	dy(11,1) = (-4.554395958965)*y(12)+(-0.005)*y(11);
	dy(12,1) = y(22)+(-0.003182219341)*y(23)+0.059524655342*y(24);
	dy(13,1) = 0.243569095885*y(23)+(-4.554395958965)*y(24)+(-0.01)*y(13);
	dy(14,1) = (-4.554395958965)*y(22)+(-8.5)*y(14)+(-18)*y(15);
	dy(15,1) = y(14);
	dy(16,1) = (-11.385989897412)*y(23)+(-8.5)*y(16)+(-18)*y(17);
	dy(17,1) = y(16);
	dy(18,1) = 0.68318607598*y(28)+0.514736886625*y(2)+0.282998565164*y(3)+0.440668616363*y(4)+(-2.382738811465)*y(5)+(-0.037424700426)*y(6)+(-0.035002491999)*y(7)+0.614952694278*y(8)+14.829958398888*y(9)+(-0.110759742503)*y(10)+(-0.226034186438)*y(11)+4.345468653096*y(13)+0.001333027828*y(14)+0.016376955559*y(15)+(-0.010465240818)*y(16)+(-0.0094224826)*y(17)+(-6.14561518105)*y(18)+0.061014181775*y(19)+0.141165339638*y(20)+0.141806743312*y(21);
	dy(19,1) = (-36.03935472971)*y(28)+0.767400874818*y(2)+(-0.190879388177)*y(3)+(-11.678174370212)*y(4)+(-0.041149877278)*y(5)+(-0.026017271417)*y(6)+(-0.026698725144)*y(7)+0.036415219598*y(8)+0.73865635835*y(9)+6.810845841283*y(10)+(-0.38478495798)*y(11)+(-0.708557300741)*y(13)+(-0.005524328707)*y(14)+0.002522572903*y(15)+0.171826920583*y(16)+0.138368426838*y(17)+0.071909684799*y(18)+(-6.567495145681)*y(19)+0.039293511274*y(20)+0.006041152866*y(21);
	dy(20,1) = 1.997224587333*y(28)+13.482210983798*y(2)+2.488520358003*y(3)+0.076750797248*y(4)+0.804972334222*y(5)+0.023466195202*y(6)+(-0.022740687251)*y(7)+0.018646161041*y(8)+0.436604617107*y(9)+(-0.414374632569)*y(10)+(-6.563020897889)*y(11)+(-1.423460802051)*y(13)+(-0.224998971426)*y(14)+(-0.259852011779)*y(15)+(-0.008437464875)*y(16)+(-0.00394534411)*y(17)+0.102235829031*y(18)+0.191829027845*y(19)+(-6.31242884154)*y(20)+(-0.038075090345)*y(21);
	dy(21,1) = c*y(28)+(-3.415298165208)*y(2)+(-1.836225244248)*y(3)+(-0.015605131825)*y(4)+10.4868455956*y(5)+(-0.031379180918)*y(6)+0.00126674641*y(7)+0.525873993847*y(8)+9.808565668907*y(9)+(-0.367529750255)*y(10)+1.37040552413*y(11)+(-12.076970057329)*y(13)+0.004883176776*y(14)+(-0.015765473705)*y(15)+(-3.99777933E-4)*y(16)+(-4.97333312E-4)*y(17)+0.199818976539*y(18)+(-0.002648145523)*y(19)+(-0.101212258081)*y(20)+(-5.199268943788)*y(21);
	dy(22,1) = (-11.570495605469)*y(22)+(-2.544637680054)*y(23)+(-0.063602626324)*y(24)+0.106780529022*y(25)+(-0.09491866827)*y(26)+0.007107574493*y(27)+(-3.700790207851)*y(28)+(-16.213284674534)*y(2)+(-2.984968535139)*y(3)+(-0.493137919288)*y(4)+(-1.186954196152)*y(5)+(-0.031106608756)*y(6)+0.024595252653*y(7)+0.008231369923*y(8)+0.231787619674*y(9)+0.745302732591*y(10)+7.895709940231*y(11)+2.026930360369*y(13)+0.271792657736*y(14)+0.315196108541*y(15)+0.01587684771*y(16)+0.009288507454*y(17)+0.087920280806*y(18)+(-0.103727794204)*y(19)+(-4.447282126346)*y(20)+0.016271459306*y(21);
	dy(23,1) = a*y(22)+(-1.998182296753)*y(23)+0.016651883721*y(25)+0.018462046981*y(26)+(-0.001187470742)*y(27)+(-7.517319654181)*y(28)+0.236494174025*y(2)+(-0.028725044803)*y(3)+(-2.442989538035)*y(4)+0.03451055081*y(5)+(-0.004683216652)*y(6)+(-0.00515403869)*y(7)+(-0.002104275246)*y(8)+(-0.079935853309)*y(9)+1.420125114638*y(10)+(-0.117856066698)*y(11)+(-0.226142434271)*y(13)+(-0.002585832387)*y(14)+(-0.001365917341)*y(15)+0.035962654791*y(16)+0.028993699893*y(17)+(-0.045896888864)*y(18)+0.716358354284*y(19)+0.029085601036*y(20)+(-0.001242728387)*y(21);
	dy(24,1) = (-2.040895462036)*y(22)+(-0.458999156952)*y(23)+(-0.73502779007)*y(24)+0.019255757332*y(25)+(-0.00459562242)*y(26)+0.002120360732*y(27)+(-0.740775522612)*y(28)+(-2.555714688932)*y(2)+(-0.339301128908)*y(3)+(-0.033104023297)*y(4)+(-1.446467788369)*y(5)+(-0.007442776396)*y(6)+(-0)*y(7)+0.030657946816*y(8)+1.002118140789*y(9)+0.153644862643*y(10)+1.273828227991*y(11)+1.983204935524*y(13)+0.048757213739*y(14)+0.060295617991*y(15)+0.001605314985*y(16)+5.54368427E-4*y(17)+0.475422075598*y(18)+(-0.010880647601)*y(19)+(-0.775712358056)*y(20)+(-0.408545111762)*y(21);
	dy(25,1) = (-32.103607177734)*y(1)+(-0.503355026245)*y(22)+2.297859191895*y(23)+(-0.021215811372)*y(25)+(-0.02116791904)*y(26)+0.01581159234*y(27)+8.689411857722*y(28)+(-0.215429806172)*y(2)+0.063500560122*y(3)+2.847523923644*y(4)+(-0.297021616015)*y(5)+0.001323463163*y(6)+0.002124820781*y(7)+0.068860932948*y(8)+1.694077894544*y(9)+(-1.639571645676)*y(10)+0.110652545728*y(11)+0.728735301618*y(13)+0.003107735169*y(14)+0.003335187976*y(15)+(-0.042347579477)*y(16)+(-0.034247794709)*y(17)+0.469091132962*y(18)+(-0.814424502262)*y(19)+(-0.018082452136)*y(20)+0.016747349252*y(21);
	dy(26,1) = 0.102161169052*y(1)+32.057830810547*y(12)+(-2.347217559814)*y(22)+(-0.503611564636)*y(23)+0.83494758606*y(24)+0.02122657001*y(25)+(-0.037879735231)*y(26)+3.5400386E-4*y(27)+(-0.560681623936)*y(28)+(-3.574948145694)*y(2)+(-0.788176766644)*y(3)+(-0.107590635594)*y(4)+0.908657075077*y(5)+(-0.008720966051)*y(6)+0.005669792925*y(7)+0.044884407612*y(8)+0.788227489086*y(9)+0.111065913657*y(10)+1.709840089441*y(11)+(-0.946574755181)*y(13)+0.054255711842*y(14)+0.060392345409*y(15)+0.003299051857*y(16)+0.00196559253*y(17)+(-0.03560723866)*y(18)+(-0.021984114632)*y(19)+(-0.893130060176)*y(20)+0.503048977806*y(21);
	dy(27,1) = (-b)*y(1)+1.713829040527*y(12)+(-0.004005432129)*y(22)+(-0.057411193848)*y(23)+0.013989634812*y(25)+(-9.06753354E-4)*y(26)+(-0.290513515472)*y(27)+(-1.440209153996)*y(28)+(-1.089782421583)*y(2)+(-0.599051729911)*y(3)+(-0.930901394778)*y(4)+5.04406072285*y(5)+0.079229241316*y(6)+0.074101747848*y(7)+(-1.301808243838)*y(8)+(-31.393874531397)*y(9)+0.233327947688*y(10)+0.478559456452*y(11)+(-9.198865975131)*y(13)+(-0.002820980233)*y(14)+(-0.034669033757)*y(15)+0.022125233836*y(16)+0.01992340894*y(17)+(-8.159414332666)*y(18)+(-0.129736796488)*y(19)+(-0.298841506489)*y(20)+(-0.30019373275)*y(21);
	dy(28,1) = 0.050176870833*y(1)+(-0.003161246171)*y(12)+(-0.48616517519)*y(22)+0.266534777047*y(23)+0.003826227932*y(24)+0*y(25)+0*y(26)+(-0)*y(27)+(-0.02065732397)*y(28)+0.001301453941*y(2)+0.213359280279*y(3)+0.881596311923*y(4)+0.051809053856*y(5)+0*y(6)+0*y(7)+0*y(8);

end





